
EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H

PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H
TIMER_CONT EQU 10H
TIMER_COMP EQU 11H
N_CLOCK EQU 10

ORG 40
IP_CLOCK DW RUT_CLOCK

ORG 1000H
SEGS DB 0
SENTIDO DB 1
TABLA DB 1, 2, 4, 8, 16, 32, 64, 128
FIN_TABLA DB ?

ORG 3000H
RUT_CLOCK: INC SEGS
CMP SEGS, 0FFH
JNZ VALID
MOV SEGS, 0
VALID: PUSH AX
CMP SENTIDO, 1
JS RETORNA

INC BX
CMP BX, OFFSET FIN_TABLA ; Verifico si llegue al final de la tabla
JNZ OK
MOV SENTIDO, 0
OK: JMP LUCES

RETORNA: DEC BX
CMP BX, OFFSET TABLA ; Verifico si es el inicio de la tabla
JNZ LUCES
MOV SENTIDO, 1

LUCES: MOV AL, [BX]
OUT PB, AL
MOV AL, 0
OUT TIMER_CONT, AL
MOV AL, EOI
OUT EOI, AL
POP AX
IRET

ORG 2000H
MOV AL, 11111101b
OUT IMR, AL

MOV AL, N_CLOCK
OUT INT1, AL

CLI
MOV AL, 1
OUT TIMER_COMP, AL ; Seteo comparador del timer
OUT PB, AL ; Inicializo PB en 1

MOV AL, 0FFH
OUT CA, AL ; Seteo PA como entradas/microconmutadores

MOV AL, 0
OUT CB, AL ; Seteo PB como salida
OUT TIMER_CONT, AL ; Inicializo contador en 0

MOV BX, OFFSET TABLA
STI

LOOP: JMP LOOP

INT 0
END



