

PIC EQU 20H
IMR EQU 21H
INT1 EQU 25H

PB EQU 31H
CB EQU 33H

N_CLK EQU 10

TIMER_CONT EQU 10H
TIMER_COMP EQU 11H

ORG 40
IP_CLK DW RUT_CLK

ORG 1000H
LUCES DB 1, 2, 4, 8, 16, 32, 64, 128

ORG 1200H
NUMS DB ?

ORG 3000H
LECTURA: NOP
 INT 6
 INC BX
 DEC CL
 JNZ LECTURA
 RET
 
RUT_CLK: PUSH AX
 PUSH DX
 SUB BYTE PTR [BX], 30H
 MOV DL, [BX]
 PUSH BX
 MOV BX, OFFSET LUCES
 ADD BL, DL
 MOV AL, [BX]
 OUT PB, AL
 POP BX
 INC BX
 MOV AL, 0
 OUT TIMER_CONT, AL
 MOV AL, PIC
 OUT PIC, AL
 POP DX
 POP AX
 IRET
 
ORG 2000H
MOV BX, OFFSET NUMS
MOV CL, 5
CALL LECTURA

;Configuracion PIO
MOV AL, 0
OUT CB, AL
MOV AL, 1
OUT PB, AL

;Configuracion PIC
CLI
IN AL, IMR
AND AL, 11111101b
OUT IMR, AL
MOV AL, N_CLK
OUT INT1, AL
MOV AL, 0
OUT TIMER_CONT, AL
MOV AL, 1
OUT TIMER_COMP, AL
STI

MOV BX, OFFSET NUMS
MOV DX, BX
ADD DX, 5

LAZO: CMP DX, BX
 JNZ LAZO
 
INT 0
END
