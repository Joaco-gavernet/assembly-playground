;ejecutar en Vonsim version vieja
TIMER_CONT EQU 10H
TIMER_COMP EQU 11H
PIC EQU 20H
EOI EQU 20H
IMR EQU 21H
IRR EQU 22H
ISR EQU 23H
INT0 EQU 24H
INT1 EQU 25H
N_CLK EQU 10
N_F10 EQU 11

ORG 40
IP_CLK DW RUT_CLK

ORG 44
IP_F10 DW RUT_F10

ORG 1000H
UNIDADES DB 30H ;inicializan en "0" ASCII
DECENAS DB 30H
DB 20H
FIN DB ?

ORG 3000H
RUT_CLK: PUSH AX
INC UNIDADES
CMP UNIDADES, 3AH
JNZ RESET

MOV UNIDADES, 30H
INC DECENAS
CMP DECENAS, 33H ;verifico si llego a los 30seg
JNZ RESET
MOV DECENAS, 30H

RESET: INT 7
MOV AL, 0
OUT TIMER_CONT, AL
MOV AL, EOI
OUT PIC, AL
POP AX
IRET

RUT_F10: PUSH AX ;preservo el contexto
IN AL, IMR ;leo mascara actual
XOR AL, 02H ;enmascaro el timer
OUT IMR, AL

MOV AL, EOI
OUT PIC, AL
POP AX
IRET

ORG 2000H
CLI
MOV AL, 0FCH ; Mascara: 1111 1100
OUT IMR, AL ; PIC: registro IMR
MOV AL, N_F10
OUT INT0, AL ; PIC: reigstro INT0 (F10)
MOV AL, N_CLK
OUT INT1, AL ; PIC: registro INT1 (TIMER)
MOV AL, 1
OUT TIMER_COMP, AL ; TIMER: registro COMP
MOV AL, 0
OUT TIMER_CONT, AL ; TIMER: registro CONT
MOV BX, OFFSET UNIDADES
MOV AL, OFFSET FIN-OFFSET UNIDADES
STI
LAZO: JMP LAZO
END
